import{_ as i,c as a,o as n,D as s,a as t,f as e,gE as l,gF as A,d3 as h,d4 as p,d5 as k,d6 as r,d7 as d,d8 as c}from"./chunks/framework.BG74BkEs.js";const R=JSON.parse('{"title":"Варианты интеграции","description":"","frontmatter":{},"headers":[],"relativePath":"ru/guide/integration-options.md","filePath":"ru/guide/integration-options.md","lastUpdated":1698833889000}'),g={name:"ru/guide/integration-options.md"},E=l+" 1x",o=A+" 1x",y=h+" 1x",F=p+" 1x",m=k+" 1x",v=r+" 1x",u=d+" 1x",C=c+" 1x",B=s("h1",{id:"варианты-интеграции",tabindex:"-1"},[t("Варианты интеграции "),s("a",{class:"header-anchor vp-link",href:"#варианты-интеграции","aria-label":'Permalink to "Варианты интеграции"'},"​")],-1),b=s("p",null,"В то время как Naninovel фокусируется на построении традиционных визуальных новелл, движок разработан таким образом, чтобы обеспечить интеграцию в существующие проекты. Если вы создаете 3D-приключенческую игру, RPG или игру любого другого жанра, вы можете использовать Naninovel в качестве встроенной диалоговой системы.",-1),D=s("div",{class:"imgit-video",style:{display:"flex"},"data-imgit-container":""},[s("div",{style:{width:"100%"}},[s("video",{"data-imgit-loadable":"",preload:"none",loop:"",autoplay:"",muted:"",playsinline:"",width:"720",height:"400"},[s("source",{"data-imgit-src":"/imgit/encoded/i.gyazo.com-b1b6042db4a91b3a8cee74236b33c17c.mp4@main.mp4",type:"video/mp4; codecs=av01.0.04M.08"}),s("source",{"data-imgit-src":"/imgit/fetched/i.gyazo.com-b1b6042db4a91b3a8cee74236b33c17c.mp4"})])]),s("picture",{class:"imgit-cover",style:{width:"100%","margin-left":"-100%"}},[s("source",{srcset:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAAD5bWV0YQAAAAAAAAAvaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAFBpY3R1cmVIYW5kbGVyAAAAAA5waXRtAAAAAAABAAAAHmlsb2MAAAAARAAAAQABAAAAAQAAASEAAAAxAAAAKGlpbmYAAAAAAAEAAAAaaW5mZQIAAAAAAQAAYXYwMUNvbG9yAAAAAGppcHJwAAAAS2lwY28AAAAUaXNwZQAAAAAAAAAkAAAAFAAAABBwaXhpAAAAAAMICAgAAAAMYXYxQ4EADAAAAAATY29scm5jbHgAAgACAAIAAAAAF2lwbWEAAAAAAAAAAQABBAECgwQAAAA5bWRhdAoGGBUjm0AQMicVwAggQQSIEQDe0mmT9RBs3aIN2NfyrnhR9xZza4oSSZJ6gcWqgkA=",type:"image/avif"}),s("img",{src:"//:0",alt:"cover",width:"720",height:"400",decoding:"sync"})])],-1),w=e('<p>Существует несколько способов интеграции Naninovel в пользовательский проект, и конкретная реализация будет зависеть от типа проекта и того, чего именно вы хотите достичь с помощью Naninovel. В следующей документации мы перечислим различные параметры конфигурации и API, которые могут быть полезны для &quot;сопряжения&quot; Naninovel с автономной игрой. Прежде чем продолжить, взгляните на <a href="/naninovel-docs/ru/guide/engine-architecture" class="vp-link">архитектуру движка</a>, чтобы лучше понять, как он ведет себя на концептуальном уровне.</p><div class="tip custom-block"><p class="custom-block-title">EXAMPLE</p><p>Изучите <a href="/naninovel-docs/ru/guide/integration-options#example-project" class="vp-link">пример проекта</a>, где Naninovel используется и как встроенная диалоговая система для 3D приключенческой игры, и как переключаемый автономный новый режим.</p></div><h2 id="ручная-инициализация" tabindex="-1">Ручная инициализация <a class="header-anchor vp-link" href="#ручная-инициализация" aria-label="Permalink to &quot;Ручная инициализация&quot;">​</a></h2><p>Первое, что вы, вероятно, захотите изменить – это отключить опцию <code>Initialize On Application Load</code> в меню конфигурации движка.</p><div class="imgit-picture" style="display:flex;" data-imgit-container><picture style="width:100%;"><source srcset="'+E+'" type="image/avif"><source srcset="'+o+`"><img data-imgit-loadable alt="" width="720" height="291" loading="lazy" decoding="async"></picture><picture class="imgit-cover" style="width:100%;margin-left:-100%;"><source srcset="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAAD5bWV0YQAAAAAAAAAvaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAFBpY3R1cmVIYW5kbGVyAAAAAA5waXRtAAAAAAABAAAAHmlsb2MAAAAARAAAAQABAAAAAQAAASEAAABTAAAAKGlpbmYAAAAAAAEAAAAaaW5mZQIAAAAAAQAAYXYwMUNvbG9yAAAAAGppcHJwAAAAS2lwY28AAAAUaXNwZQAAAAAAAAAkAAAADwAAABBwaXhpAAAAAAMICAgAAAAMYXYxQ4EgAAAAAAATY29scm5jbHgAAgACAACAAAAAF2lwbWEAAAAAAAAAAQABBAECgwQAAABbbWRhdAoIOBTj5pAQ0AIyRxXAAABIAEDLzlGhWgWgkcVP29Gpa6l+cMlWJsM0QpZf8by98+JDXE4QBjWfbd2bKFV5fsaW2Fk4i3bMaxM1QlwR+k90KhiA" type="image/avif"><img src="//:0" alt="cover" width="720" height="291" decoding="sync"></picture></div><p>Если этот параметр включен, сервисы движка будут автоматически инициализироваться при запуске приложения. И если вы не хотите начать свою игру в режиме новеллы, вам стоит вручную инициализировать движок, когда это действительно необходимо.</p><p>Используйте статический асинхронный метод <code>RuntimeInitializer.InitializeAsync()</code> (или пользовательский скрипт) для инициализации движка во время выполнения перед использованием любого из встроенных API сервисов. Вы можете проверить, инициализирован ли движок в данный момент с помощью свойства <code>Engine.Initialized</code>. Используйте событие <code>Engine.OnInitialized</code> для прослушивания событий завершения инициализации.</p><p>Чтобы сбросить сервисы движка (и выгрузить большую часть занятых ресурсов), используйте метод <code>ResetStateAsync()</code> сервиса <code>IStateManager</code>; это полезно, когда вы собираетесь временно переключиться в какой-то другой игровой режим, чтобы иметь возможность вернуться в новый режим без повторной инициализации движка.</p><p>Чтобы уничтожить все сервисы движка и полностью удалить Naninovel из памяти, используйте статический метод <code>Engine.Destroy()</code>.</p><h2 id="проигрывание-сценариев-naninovel" tabindex="-1">Проигрывание сценариев Naninovel <a class="header-anchor vp-link" href="#проигрывание-сценариев-naninovel" aria-label="Permalink to &quot;Проигрывание сценариев Naninovel&quot;">​</a></h2><p>Чтобы подзагрузить и воспроизвести любой новый сценарий с заданным именем, используйте метод <code>PreloadAndPlayAsync(ScriptName)</code> сервиса <code>IScriptPlayer</code>. Чтобы получить сервис движка, используйте статический метод <code>Engine.GetService&lt;TService&gt;()</code>, где <code>TService</code> - это тип (интерфейс) извлекаемого сервиса. Например, ниже будет получен сервис плеера сценариев, затем предварительно загружен и воспроизведён скрипт с именем &quot;Script 001&quot;:</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> player</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IScriptPlayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> player.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PreloadAndPlayAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Script001&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>При выходе из нового режима и возвращении в основной игровой режим вы, вероятно, захотите выгрузить все ресурсы, используемые Naninovel в настоящее время, и остановить все сервисы движка. Для этого используйте метод <code>ResetStateAsync()</code> сервиса <code>IStateManager</code>:</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> stateManager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IStateManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stateManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResetStateAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h2 id="отключение-главного-меню" tabindex="-1">Отключение главного меню <a class="header-anchor vp-link" href="#отключение-главного-меню" aria-label="Permalink to &quot;Отключение главного меню&quot;">​</a></h2><p>Встроенная реализация главного меню будет автоматически отображаться при инициализации движка, в то время как у вас, скорее всего, будет свое собственное главное меню. Вы можете либо изменить или полностью заменить встроенное меню, используя <a href="/naninovel-docs/ru/guide/user-interface#кастомизация-UI" class="vp-link">функцию настройки UI</a> или просто отключить его, отключив <code>Show Title UI</code> в меню конфигурации движка.</p><h2 id="слои-объектов-движка" tabindex="-1">Слой объектов движка <a class="header-anchor vp-link" href="#слои-объектов-движка" aria-label="Permalink to &quot;Слой объектов движка&quot;">​</a></h2><p>Вы можете заставить движок назначить определенный <a href="https://docs.unity3d.com/Manual/Layers.html" class="vp-link" target="_blank" rel="noreferrer">слой<span class="external-link-icon"> ↗</span></a> для всех объектов (кроме связанных с UI), которые он создает, через меню конфигурации.</p><div class="imgit-picture" style="display:flex;" data-imgit-container><picture style="width:100%;"><source srcset="`+y+'" type="image/avif"><source srcset="'+F+'"><img data-imgit-loadable alt="" width="720" height="248" loading="lazy" decoding="async"></picture><picture class="imgit-cover" style="width:100%;margin-left:-100%;"><source srcset="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAAD5bWV0YQAAAAAAAAAvaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAFBpY3R1cmVIYW5kbGVyAAAAAA5waXRtAAAAAAABAAAAHmlsb2MAAAAARAAAAQABAAAAAQAAASEAAABJAAAAKGlpbmYAAAAAAAEAAAAaaW5mZQIAAAAAAQAAYXYwMUNvbG9yAAAAAGppcHJwAAAAS2lwY28AAAAUaXNwZQAAAAAAAAAkAAAADAAAABBwaXhpAAAAAAMICAgAAAAMYXYxQ4EgAAAAAAATY29scm5jbHgAAgACAACAAAAAF2lwbWEAAAAAAAAAAQABBAECgwQAAABRbWRhdAoIOBTjtpAQ0AIyPRXAAABIERDLzgWkH3nSPFzQmRXTBXTlOrbR+wvwg2P0+Oru1ubnB6hJH1ao20uZ7m0ehjPzD7eYpLnSYI8=" type="image/avif"><img src="//:0" alt="cover" width="720" height="248" decoding="sync"></picture></div><p>При этом также камера движка будет использовать <a href="https://docs.unity3d.com/ScriptReference/Camera-cullingMask.html" class="vp-link" target="_blank" rel="noreferrer">обрезную маску<span class="external-link-icon"> ↗</span></a> и визуализировать только объекты с указанным слоем.</p><p>Чтобы изменить слой объектов UI, управляемых движком, используйте опцию <code>Objects Layer</code> в меню конфигурации UI.</p><div class="imgit-picture" style="display:flex;" data-imgit-container><picture style="width:100%;"><source srcset="'+m+'" type="image/avif"><source srcset="'+v+'"><img data-imgit-loadable alt="" width="720" height="199" loading="lazy" decoding="async"></picture><picture class="imgit-cover" style="width:100%;margin-left:-100%;"><source srcset="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAAD5bWV0YQAAAAAAAAAvaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAFBpY3R1cmVIYW5kbGVyAAAAAA5waXRtAAAAAAABAAAAHmlsb2MAAAAARAAAAQABAAAAAQAAASEAAACcAAAAKGlpbmYAAAAAAAEAAAAaaW5mZQIAAAAAAQAAYXYwMUNvbG9yAAAAAGppcHJwAAAAS2lwY28AAAAUaXNwZQAAAAAAAAAkAAAACgAAABBwaXhpAAAAAAMICAgAAAAMYXYxQ4EgAAAAAAATY29scm5jbHgAAgACAACAAAAAF2lwbWEAAAAAAAAAAQABBAECgwQAAACkbWRhdAoIOBTjlpAQ0AIyjwEVwAooQQSRRQD7WEPM+NdXyovQaXNXiqo7NhcHehUhi1Sq18k7rWdwCDA2/OaPou7nFJ3H5Zflc860gwctnOgGshYoJZwbp/tXn5ZfOsh6OdcZrFwHYLKr/9USsoRFCZLfq1KLzT7TfST1VRBy9CrCO0as/NtADzVmG3AycSBHkh8ZIVwxZwroHHcBkrVKGA==" type="image/avif"><img src="//:0" alt="cover" width="720" height="199" decoding="sync"></picture></div><h2 id="рендеринг-в-текстуру" tabindex="-1">Рендеринг в текстуру <a class="header-anchor vp-link" href="#рендеринг-в-текстуру" aria-label="Permalink to &quot;Рендеринг в текстуру&quot;">​</a></h2><p>Вы можете сделать рендеринг камеры движка в пользовательскую <a href="https://docs.unity3d.com/ScriptReference/RenderTexture.html" class="vp-link" target="_blank" rel="noreferrer">текстуру рендеринга<span class="external-link-icon"> ↗</span></a> вместо экрана (и изменить другие настройки, связанные с камерой), назначив пользовательский префаб камеры в меню конфигурации камеры.</p><div class="imgit-picture" style="display:flex;" data-imgit-container><picture style="width:100%;"><source srcset="'+u+'" type="image/avif"><source srcset="'+C+`"><img data-imgit-loadable alt="" width="720" height="243" loading="lazy" decoding="async"></picture><picture class="imgit-cover" style="width:100%;margin-left:-100%;"><source srcset="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAAD5bWV0YQAAAAAAAAAvaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAFBpY3R1cmVIYW5kbGVyAAAAAA5waXRtAAAAAAABAAAAHmlsb2MAAAAARAAAAQABAAAAAQAAASEAAABbAAAAKGlpbmYAAAAAAAEAAAAaaW5mZQIAAAAAAQAAYXYwMUNvbG9yAAAAAGppcHJwAAAAS2lwY28AAAAUaXNwZQAAAAAAAAAkAAAADAAAABBwaXhpAAAAAAMICAgAAAAMYXYxQ4EgAAAAAAATY29scm5jbHgAAgACAACAAAAAF2lwbWEAAAAAAAAAAQABBAECgwQAAABjbWRhdAoIOBTjtpAQ0AIyTxXAAghBBIAEAO5Ndm6QvIu0va4gLF+GuviTcAmx7HtIQqFMMQETTiWxbZM6Rf5kigZ8V0JOeJqwOwvZObFq+cp33Eq6NCsqOFLPWdOGFXg=" type="image/avif"><img src="//:0" alt="cover" width="720" height="243" decoding="sync"></picture></div><h2 id="переключение-режимов" tabindex="-1">Переключение режимов <a class="header-anchor vp-link" href="#переключение-режимов" aria-label="Permalink to &quot;Переключение режимов&quot;">​</a></h2><p>Хотя это сильно зависит от проекта, ниже приведен абстрактный пример (основанный на упомянутом ранее проекте интеграции) того, как вы можете реализовать переключение между режимами &quot;приключения&quot; и &quot;новеллы&quot; с помощью пользовательских команд.</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CommandAlias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;novel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SwitchToNovelMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Command</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StringParameter</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScriptName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StringParameter</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UniTask</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExecuteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AsyncToken</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> asyncToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1. Disable character control.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FindObjectOfType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CharacterController3D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        controller.IsInputBlocked </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2. Switch cameras.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> advCamera</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GameObject.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AdventureModeCamera&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Camera</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        advCamera.enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> naniCamera</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ICameraManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;().Camera;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        naniCamera.enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3. Load and play specified script (if assigned).</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Assigned</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ScriptName))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scriptPlayer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IScriptPlayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scriptPlayer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PreloadAndPlayAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ScriptName, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: Label);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4. Enable Naninovel input.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> inputManager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IInputManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        inputManager.ProcessInput </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CommandAlias</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;adventure&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SwitchToAdventureMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Command</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UniTask</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExecuteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AsyncToken</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> asyncToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1. Disable Naninovel input.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> inputManager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IInputManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        inputManager.ProcessInput </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2. Stop script player.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scriptPlayer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IScriptPlayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        scriptPlayer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3. Reset state.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> stateManager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IStateManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stateManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResetStateAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4. Switch cameras.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> advCamera</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GameObject.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AdventureModeCamera&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Camera</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        advCamera.enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> naniCamera</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ICameraManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;().Camera;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        naniCamera.enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 5. Enable character control.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FindObjectOfType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CharacterController3D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        controller.IsInputBlocked </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Затем команды могут быть использованы в сценариях Naninovel:</p><div class="language-nani vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nani</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#ACB5C6;--shiki-dark:#5D6470;">; Перейти в приключенческий режим.</span></span>
<span class="line"><span style="--shiki-light:#257DC8;--shiki-dark:#6CB2ED;">@adventure</span></span></code></pre></div><p>— или напрямую в C# (например, в событиях Unity <code>OnTrigger</code>):</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OnTriggerEnter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Collider</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> other</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> switchCommand</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SwitchToNovelMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ScriptName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Script001&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	switchCommand.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecuteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Forget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="другие-варианты" tabindex="-1">Другие варианты <a class="header-anchor vp-link" href="#другие-варианты" aria-label="Permalink to &quot;Другие варианты&quot;">​</a></h2><p>Существует множество других функций (аутсорсинг состояния, переопределение сервисов, пользовательская сериализация, провайдеры ресурсов и конфигураций и т.д.), которые могут быть ситуационно полезны при интеграции движка в другие системы; ознакомьтесь с остальной частью руководства для получения дополнительной информации. Также вы можете изучить доступные <a href="/naninovel-docs/ru/guide/configuration" class="vp-link">параметры конфигурации</a>; некоторые функции могут быть не описаны в руководстве, но все же удобны при интеграции.</p><p>Если вы чувствуете, что каким-то API или системам движка или не хватает расширяемости и требуется модификация исходного кода для интеграции, пожалуйста, <a href="/naninovel-docs/ru/support/#developer—support" class="vp-link">свяжитесь с разработчиком</a> – мы рассмотрим возможности улучшения.</p><h2 id="демонстрационныи-проект" tabindex="-1">Демонстрационный проект <a class="header-anchor vp-link" href="#демонстрационныи-проект" aria-label="Permalink to &quot;Демонстрационный проект&quot;">​</a></h2><p>Пример проекта с Naninovel, где движок используется как в качестве диалоговой системы для 3D-приключенческой игры, так и в переключаемом автономном режиме новеллы, <a href="https://github.com/Naninovel/IntegrationExample" class="vp-link" target="_blank" rel="noreferrer">доступен на GitHub<span class="external-link-icon"> ↗</span></a>. Вы можете <a href="https://help.github.com/en/github/creating-cloning-and-archiving-repositories/cloning-a-repository" class="vp-link" target="_blank" rel="noreferrer">клонировать репозиторий<span class="external-link-icon"> ↗</span></a> с помощью Git-клиента или <a href="https://github.com/Naninovel/IntegrationExample/archive/master.zip" class="vp-link" target="_blank" rel="noreferrer">скачать его в виде zip-архива<span class="external-link-icon"> ↗</span></a>.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Пакет Naninovel не распространяется вместе с проектом, поэтому ошибки компиляции будут создаваться после его первого открытия; импортируйте Naninovel из Asset Store, чтобы исправить их.</p></div><p>Все сценарии, относящиеся к конкретному проекту (примеры), хранятся в папке <code>Assets/Runtime</code>.</p><p>Naninovel инициализируется вручную (автоматическая инициализация отключена в меню конфигурации движка) через скрипт <code>Runtime/SetupGame.cs</code>, прикреплённый к игровому объекту <code>SetupGame</code>, расположенному в сцене <code>MainScene</code>.</p><p>Скрипт <code>Runtime/DialogueTrigger.cs</code>, используемый в качестве компонента на триггерах, выполняет переключение в диалоговый режим, когда игрок нажимает на триггерные коллайдеры.</p><p>Пользовательская команда <code>Runtime/SwitchToNovelMode.cs</code> используется, чтобы переключиться в режим новеллы в C# и сценариях Naninovel.</p><p>Пользовательская команда <code>Runtime/SwitchToAdventureMode.cs</code> используется для переключения в приключенческий режим из режима новеллы.</p>`,44),f=[B,b,D,w];function I(S,_,G,Q,M,Y){return n(),a("div",null,f)}const N=i(g,[["render",I]]);export{R as __pageData,N as default};
