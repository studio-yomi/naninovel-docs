import{_ as A,c as e,o as a,f as i,gC as t,gD as s,gE as n,gF as c}from"./chunks/framework.BG74BkEs.js";const f=JSON.parse('{"title":"Архитектура движка","description":"","frontmatter":{},"headers":[],"relativePath":"ru/guide/engine-architecture.md","filePath":"ru/guide/engine-architecture.md","lastUpdated":1702156042000}'),l={name:"ru/guide/engine-architecture.md"},r=t+" 1x",o=s+" 1x",p=n+" 1x",d=c+" 1x",h=i('<h1 id="архитектура-движка" tabindex="-1">Архитектура движка <a class="header-anchor vp-link" href="#архитектура-движка" aria-label="Permalink to &quot;Архитектура движка&quot;">​</a></h1><p>Движок разработан с учетом следующих принципов: <strong>независимость от сцен</strong> и <strong>ориентированность на сервисы</strong>.</p><h2 id="независимость-от-сцен" tabindex="-1">Независимость от сцен <a class="header-anchor vp-link" href="#независимость-от-сцен" aria-label="Permalink to &quot;Независимость от сцен&quot;">​</a></h2><p>Дизайн Unity продвигает использование сцен и композиции префабов, что не очень практично при разработке визуальных новелл.</p><p>Все системы Naninovel либо не связаны непосредственно с <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.html" class="vp-link" target="_blank" rel="noreferrer">MonoBehaviour<span class="external-link-icon"> ↗</span></a>, либо прикреплены к <a href="https://docs.unity3d.com/ScriptReference/Object.DontDestroyOnLoad.html" class="vp-link" target="_blank" rel="noreferrer">постоянному<span class="external-link-icon"> ↗</span></a> корневому <a href="https://docs.unity3d.com/ScriptReference/GameObject.html" class="vp-link" target="_blank" rel="noreferrer">GameObject<span class="external-link-icon"> ↗</span></a>.</p><div class="imgit-picture" style="display:flex;" data-imgit-container><picture style="width:100%;"><source srcset="'+r+'" type="image/avif"><source srcset="'+o+'"><img data-imgit-loadable alt="" width="308" height="210" loading="lazy" decoding="async"></picture><picture class="imgit-cover" style="width:100%;margin-left:-100%;"><source srcset="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAAGobWV0YQAAAAAAAAAvaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAFBpY3R1cmVIYW5kbGVyAAAAAA5waXRtAAAAAAABAAAALGlsb2MAAAAARAAAAgABAAAAAQAAAdAAAAAnAAIAAAABAAAB9wAAABQAAABCaWluZgAAAAAAAgAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAGmluZmUCAAAAAAIAAGF2MDFBbHBoYQAAAAAaaXJlZgAAAAAAAAAOYXV4bAACAAEAAQAAANdpcHJwAAAAsWlwY28AAAAUaXNwZQAAAAAAAAAPAAAACgAAABBwaXhpAAAAAAMICAgAAAAMYXYxQ4EgAAAAAAATY29scm5jbHgAAgACAACAAAAAFGlzcGUAAAAAAAAADwAAAAoAAAAOcGl4aQAAAAABCAAAAAxhdjFDgQAcAAAAADhhdXhDAAAAAHVybjptcGVnOm1wZWdCOmNpY3A6c3lzdGVtczphdXhpbGlhcnk6YWxwaGEAAAAAHmlwbWEAAAAAAAAAAgABBAECgwQAAgQFBocIAAAAQ21kYXQKCDgM+lpAQ0AIMhsVwAAASEFAOBOODbrUETICmt8mlxByhc1zTNsKBRgM+lpUMgsVwAABIAABftfVkA==" type="image/avif"><img src="//:0" alt="cover" width="308" height="210" decoding="sync"></picture></div><p>В зависимости от среды используются следующие корневые объекты:</p><p>– <code>Naninovel&lt;Runtime&gt;</code> для воспроизведения (сборки и режим воспроизведения редактора); – <code>Naninovel&lt;Editor&gt;</code> для редактора (вне режима воспроизведения).</p><p>Все необходимые игровые объекты создаются при инициализации движка, которая выполняется автоматически и асинхронно при запуске приложения (сразу после входа в режим воспроизведения или запуска сборки) с помощью метода <a href="https://docs.unity3d.com/ScriptReference/RuntimeInitializeOnLoadMethodAttribute.html" class="vp-link" target="_blank" rel="noreferrer">RuntimeInitializeOnLoadMethod<span class="external-link-icon"> ↗</span></a>. Вы можете изменить это поведение, отключив свойство <code>Initialize On Application Load</code> в конфигурации движка и вручную вызвав инициализацию с помощью классов <code>RuntimeInitializer</code> (для среды выполнения) или <code>EditorInitializer</code> (для редактора).</p><div class="imgit-picture" style="display:flex;" data-imgit-container><picture style="width:100%;"><source srcset="'+p+'" type="image/avif"><source srcset="'+d+`"><img data-imgit-loadable alt="" width="720" height="291" loading="lazy" decoding="async"></picture><picture class="imgit-cover" style="width:100%;margin-left:-100%;"><source srcset="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAAD5bWV0YQAAAAAAAAAvaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAFBpY3R1cmVIYW5kbGVyAAAAAA5waXRtAAAAAAABAAAAHmlsb2MAAAAARAAAAQABAAAAAQAAASEAAABTAAAAKGlpbmYAAAAAAAEAAAAaaW5mZQIAAAAAAQAAYXYwMUNvbG9yAAAAAGppcHJwAAAAS2lwY28AAAAUaXNwZQAAAAAAAAAkAAAADwAAABBwaXhpAAAAAAMICAgAAAAMYXYxQ4EgAAAAAAATY29scm5jbHgAAgACAACAAAAAF2lwbWEAAAAAAAAAAQABBAECgwQAAABbbWRhdAoIOBTj5pAQ0AIyRxXAAABIAEDLzlGhWgWgkcVP29Gpa6l+cMlWJsM0QpZf8by98+JDXE4QBjWfbd2bKFV5fsaW2Fk4i3bMaxM1QlwR+k90KhiA" type="image/avif"><img src="//:0" alt="cover" width="720" height="291" decoding="sync"></picture></div><p>Поскольку процесс инициализации является асинхронным, используйте либо <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/" class="vp-link" target="_blank" rel="noreferrer">подход async-await<span class="external-link-icon"> ↗</span></a> при вызове метода <code>InitializeAsync()</code>, либо используйте статическое событие <code>Engine.OnInitialized</code>.</p><p>Чтобы полностью отключить и удалить из памяти все системы движка, используйте статический метод <code>Engine.Destroy()</code>.</p><h2 id="ориентированность-на-сервисы" tabindex="-1">Ориентированность на сервисы <a class="header-anchor vp-link" href="#ориентированность-на-сервисы" aria-label="Permalink to &quot;Ориентированность на сервисы&quot;">​</a></h2><p>Большинство функций движка реализуются через его сервисы. Сервис движка – это реализация интерфейса <code>IEngineService</code>, который исполняет конкретную работу – например, выполнение сценариев Naninovel, управление акторами или сохранение-загрузка состояния игры.</p><p>В случае, если вы хотите взаимодействовать с системой движка, вы, скорее всего, захотите использовать сервисы движка. Вы можете получить ссылку на сервис движка, используя статический метод <code>Engine.GetService&lt;TService&gt;()</code>, где <code>TService</code> - это тип (интерфейс) сервиса, на который вы хотите сослаться; например, чтобы получить сервис <code>IScriptPlayer</code>:</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> player</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Engine.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IScriptPlayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">player.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>Список всех доступных в настоящее время сервисов движка и информацию о том, как переопределить/добавить пользовательские сервисы, можно найти в <a href="/naninovel-docs/ru/guide/engine-services" class="vp-link">руководстве по сервисам движка</a>.</p><h2 id="высокоуровневая-концепция" tabindex="-1">Высокоуровневая концепция <a class="header-anchor vp-link" href="#высокоуровневая-концепция" aria-label="Permalink to &quot;Высокоуровневая концепция&quot;">​</a></h2><p>Следующая диаграмма UML иллюстрирует высокоуровневую концепцию архитектуры движка. Обратите внимание, что все имена классов и интерфейсов на диаграмме организованы в пространстве имён <code>Naninovel</code>. Например, чтобы сослаться на класс <code>Engine</code>, используйте <code>Naninovel.Engine</code> или <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/namespaces/using-namespaces" class="vp-link" target="_blank" rel="noreferrer">включите пространство имён<span class="external-link-icon"> ↗</span></a>.</p><p><object class="engine-design-dark" data="/assets/img/engine-design-dark.svg" type="image/svg+xml"></object><object class="engine-design-light" data="/assets/img/engine-design-light.svg" type="image/svg+xml"></object></p>`,20),g=[h];function m(k,u,b,v,y,_){return a(),e("div",null,g)}const B=A(l,[["render",m]]);export{f as __pageData,B as default};
