import{_ as s,c as i,o as a,f as e}from"./chunks/framework.BG74BkEs.js";const u=JSON.parse('{"title":"Script Expressions","description":"","frontmatter":{},"headers":[],"relativePath":"guide/script-expressions.md","filePath":"guide/script-expressions.md","lastUpdated":1703963049000}'),t={name:"guide/script-expressions.md"},n=e(`<h1 id="script-expressions" tabindex="-1">Script Expressions <a class="header-anchor vp-link" href="#script-expressions" aria-label="Permalink to &quot;Script Expressions&quot;">​</a></h1><p>When writing naninovel scripts, you can inject expression constructs to command parameter values and generic text lines using curly braces <code>{}</code>:</p><div class="language-nani vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nani</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;">One plus two equals </span><span style="--shiki-light:#3ABFB3;--shiki-dark:#62B8C1;">{1 + 2}</span><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;">.</span></span></code></pre></div><p>— will print &quot;One plus two equals 3&quot; when running the script.</p><p>You can use any math and logical operators, as well as all the math functions from the <a href="https://docs.unity3d.com/ScriptReference/Mathf.html" class="vp-link" target="_blank" rel="noreferrer">UnityEngine.Mathf<span class="external-link-icon"> ↗</span></a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.math#methods" class="vp-link" target="_blank" rel="noreferrer">System.Math<span class="external-link-icon"> ↗</span></a> namespaces:</p><div class="language-nani vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nani</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#257DC8;--shiki-dark:#6CB2ED;">@char</span><span style="--shiki-light:#9250BF;--shiki-dark:#E2BE7F;"> Kohaku</span><span style="--shiki-light:#C642A5;--shiki-dark:#CD9769;"> scale:</span><span style="--shiki-light:#3ABFB3;--shiki-dark:#62B8C1;">{Pow(Cosh(33.5), 3) % Log(0.5)}</span></span></code></pre></div><p>— will scale character with ID &quot;Kohaku&quot; to the reminder from dividing hyperbolic cosine of 33.5 angle increased to power of 3 by natural logarithm of 0.5.</p><p>The expression is evaluated at the moment the command is executed, which allows using <a href="/naninovel-docs/guide/custom-variables" class="vp-link">custom variables</a> inside the expressions:</p><div class="language-nani vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nani</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#257DC8;--shiki-dark:#6CB2ED;">@input</span><span style="--shiki-light:#9250BF;--shiki-dark:#E2BE7F;"> color</span><span style="--shiki-light:#C642A5;--shiki-dark:#CD9769;"> summary:</span><span style="--shiki-light:#9250BF;--shiki-dark:#E2BE7F;">&quot;What&#39;s your favorite color?&quot;</span></span>
<span class="line"><span style="--shiki-light:#257DC8;--shiki-dark:#6CB2ED;">@stop</span></span>
<span class="line"><span style="--shiki-light:#3ABFB3;--shiki-dark:#62B8C1;">{color}</span><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;">, huh? </span><span style="--shiki-light:#3ABFB3;--shiki-dark:#62B8C1;">{ color == &quot;orange&quot; ? &quot;Mine too!&quot; : (color == &quot;black&quot; ? &quot;That&#39;s depressing.&quot; : &quot;I see...&quot;) }</span></span></code></pre></div><p>— will show an input UI allowing player to input their favorite color, assigning it to <code>color</code> custom variable, then print the inputted color, followed by either &quot;Mine too!&quot; in case it&#39;s &quot;orange&quot;, &quot;That&#39;s depressing.&quot; in case it&#39;s &quot;black&quot; or &quot;I see...&quot; in the other cases.</p><p>To distinguish a plain text value from a variable name, wrap the value in double quotes <code>&quot;</code>:</p><div class="language-nani vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nani</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;">This is just a plain text: </span><span style="--shiki-light:#3ABFB3;--shiki-dark:#62B8C1;">{ &quot;score&quot; }</span><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;">.</span></span>
<span class="line"><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;">And this is the value of &quot;score&quot; variable: </span><span style="--shiki-light:#3ABFB3;--shiki-dark:#62B8C1;">{ score }</span><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;">.</span></span></code></pre></div><p>In case you wish to include the double quotes in the expression, escape them:</p><div class="language-nani vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nani</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;">Saying </span><span style="--shiki-light:#3ABFB3;--shiki-dark:#62B8C1;">{ \\&quot;Stop the car\\&quot; }</span><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;"> was a mistake.</span></span></code></pre></div><p>Script expressions used in <a href="/api/#set" target="_blank"><code>@set</code></a> and <a href="/api/#if" target="_blank"><code>@if</code></a> commands (as well as <code>set</code> and <code>if</code> parameters in other commands), doesn&#39;t require curly braces:</p><div class="language-nani vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nani</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#257DC8;--shiki-dark:#6CB2ED;">@set</span><span style="--shiki-light:#9250BF;--shiki-dark:#E2BE7F;"> randomScore=Random(-100,100)</span></span>
<span class="line"><span style="--shiki-light:#257DC8;--shiki-dark:#6CB2ED;">@goto</span><span style="--shiki-light:#9250BF;--shiki-dark:#E2BE7F;"> EpicLabel</span><span style="--shiki-light:#C642A5;--shiki-dark:#CD9769;"> if:</span><span style="--shiki-light:#9250BF;--shiki-dark:#E2BE7F;">Abs(randomScore)&gt;=50</span></span></code></pre></div><p>Though, just like with all the other parameter values, in case you wish to use spaces inside the expressions, you should wrap them in double quotes:</p><div class="language-nani vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nani</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#257DC8;--shiki-dark:#6CB2ED;">@set</span><span style="--shiki-light:#9250BF;--shiki-dark:#E2BE7F;"> &quot;randomScore = Random(-100, 100)&quot;</span></span>
<span class="line"><span style="--shiki-light:#257DC8;--shiki-dark:#6CB2ED;">@goto</span><span style="--shiki-light:#9250BF;--shiki-dark:#E2BE7F;"> EpicLabel</span><span style="--shiki-light:#C642A5;--shiki-dark:#CD9769;"> if:</span><span style="--shiki-light:#9250BF;--shiki-dark:#E2BE7F;">&quot;Abs(randomScore) &gt;= 50&quot;</span></span></code></pre></div><p>To print curly braces inside a generic text line and prevent them from being recognized as an expression start and end literals, escape the braces with backslashes, eg:</p><div class="language-nani vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nani</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#4B5871;--shiki-dark:#ACB2BE;">Some text \\{ text inside braces \\}</span></span></code></pre></div><p>— will print &quot;Some text { text inside braces }&quot; in-game.</p><h2 id="expression-functions" tabindex="-1">Expression Functions <a class="header-anchor vp-link" href="#expression-functions" aria-label="Permalink to &quot;Expression Functions&quot;">​</a></h2><p>The following functions can also be used inside the script expressions.</p><div class="config-table"><table><thead><tr><th>Signature</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td>Random (<em>System.Double</em> min, <em>System.Double</em> max)</td><td>Return a random float number between min [inclusive] and max [inclusive].</td><td><code>Random(0.1, 0.85)</code></td></tr><tr><td>Random (<em>System.Int32</em> min, <em>System.Int32</em> max)</td><td>Return a random integer number between min [inclusive] and max [inclusive].</td><td><code>Random(0, 100)</code></td></tr><tr><td>Random (<em>System.String[]</em> args)</td><td>Return a string chosen from one of the provided strings.</td><td><code>Random(&quot;Foo&quot;, &quot;Bar&quot;, &quot;Foobar&quot;)</code></td></tr><tr><td>CalculateProgress ()</td><td>Return a float number in 0.0 to 1.0 range, representing how many unique commands were ever executed compared to the total number of commands in all the available naninovel scripts. 1.0 means the player had <code>read through</code> or <code>seen</code> all the available game content. Make sure to enable <code>Count Total Commands</code> in the script configuration menu before using this function.</td><td><code>CalculateProgress()</code></td></tr><tr><td>IsUnlocked (<em>System.String</em> unlockableId)</td><td>Checks whether an unlockable item with the provided ID is currently unlocked.</td><td><code>IsUnlocked(&quot;Tips/MyTip&quot;)</code></td></tr><tr><td>HasPlayed ()</td><td>Checks whether currently played command has ever been played before.</td><td><code>HasPlayed()</code></td></tr><tr><td>HasPlayed (<em>System.String</em> scriptName)</td><td>Checks whether script with the provided name has ever been played before.</td><td><code>HasPlayed(&quot;Script001&quot;)</code></td></tr><tr><td>GetName (<em>System.String</em> id)</td><td>Returns display name of a character actor with the provided ID.</td><td><code>GetName(&quot;Kohaku&quot;)</code></td></tr></tbody></table></div><h2 id="adding-custom-functions" tabindex="-1">Adding Custom Functions <a class="header-anchor vp-link" href="#adding-custom-functions" aria-label="Permalink to &quot;Adding Custom Functions&quot;">​</a></h2><p>It&#39;s possible to add custom expression functions by assigning <code>ExpressionFunctions</code> attribute to a static C# class. All the public methods of this class with compatible signatures will then automatically become available in the script expressions.</p><p>Only <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/types#simple-types" class="vp-link" target="_blank" rel="noreferrer">simple<span class="external-link-icon"> ↗</span></a> and string types are supported as argument and return types. It&#39;s also possible to use a single variadic (<code>params</code> keyword) argument; mixing a variadic with other arguments is not supported. To represent fractions, use <code>double</code> type (<code>float</code> is not supported).</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes theme-light theme-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Naninovel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExpressionFunctions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomFunctions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// Returns the provided string with all characters converted to lower-case.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ToLower</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToLower</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Returns the sum of the provided numbers.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Returns the remainder resulting from dividing the provided numbers.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> double</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Modulus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Returns a string randomly chosen from one of the provided strings.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (args </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args.Length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> randomIndex</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UnityEngine.Random.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, args.Length);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args[randomIndex];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">EXAMPLE</p><p>Another example of adding custom expression functions to check whether an item exists in an inventory can be found in the <a href="https://github.com/naninovel/samples/tree/main/unity/inventory" class="vp-link" target="_blank" rel="noreferrer">inventory example project on GitHub<span class="external-link-icon"> ↗</span></a>.</p><p>Specifically, the custom functions are implemented via <a href="https://github.com/naninovel/samples/blob/main/unity/inventory/Assets/NaninovelInventory/Runtime/InventoryFunctions.cs" class="vp-link" target="_blank" rel="noreferrer">InventoryFunctions.cs<span class="external-link-icon"> ↗</span></a> runtime script.</p></div>`,29),l=[n];function p(h,r,o,d,k,c){return a(),i("div",null,l)}const m=s(t,[["render",p]]);export{u as __pageData,m as default};
